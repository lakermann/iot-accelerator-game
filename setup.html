<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Setup | IoT Accelerometer Game</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="Course material for the 'event processing with Microsoft Azure' Workshop.">
    
    <link rel="preload" href="/iot-accelerator-game/assets/css/0.styles.d14abbf8.css" as="style"><link rel="preload" href="/iot-accelerator-game/assets/js/app.48d93215.js" as="script"><link rel="preload" href="/iot-accelerator-game/assets/js/2.d578e91a.js" as="script"><link rel="preload" href="/iot-accelerator-game/assets/js/9.518203b7.js" as="script"><link rel="prefetch" href="/iot-accelerator-game/assets/js/3.c895e0be.js"><link rel="prefetch" href="/iot-accelerator-game/assets/js/4.3741762e.js"><link rel="prefetch" href="/iot-accelerator-game/assets/js/5.9e1df5d7.js"><link rel="prefetch" href="/iot-accelerator-game/assets/js/6.047fb51f.js"><link rel="prefetch" href="/iot-accelerator-game/assets/js/7.a5c1c0e6.js"><link rel="prefetch" href="/iot-accelerator-game/assets/js/8.cb2c09d6.js">
    <link rel="stylesheet" href="/iot-accelerator-game/assets/css/0.styles.d14abbf8.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/iot-accelerator-game/" class="home-link router-link-active"><!----> <span class="site-name">IoT Accelerometer Game</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"> <a href="https://github.com/lakermann/iot-accelerator-game" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"> <a href="https://github.com/lakermann/iot-accelerator-game" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Guide</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/iot-accelerator-game/" aria-current="page" class="sidebar-link">Introduction</a></li><li><a href="/iot-accelerator-game/setup.html" aria-current="page" class="active sidebar-link">Setup</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/iot-accelerator-game/setup.html#tools" class="sidebar-link">Tools</a></li><li class="sidebar-sub-header"><a href="/iot-accelerator-game/setup.html#backend-services" class="sidebar-link">Backend Services</a></li><li class="sidebar-sub-header"><a href="/iot-accelerator-game/setup.html#frontend" class="sidebar-link">Frontend</a></li><li class="sidebar-sub-header"><a href="/iot-accelerator-game/setup.html#ranking" class="sidebar-link">Ranking</a></li></ul></li><li><a href="/iot-accelerator-game/exercises.html" class="sidebar-link">Exercises</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="setup"><a href="#setup" class="header-anchor">#</a> Setup</h1> <h2 id="tools"><a href="#tools" class="header-anchor">#</a> Tools</h2> <p>Installation script: <a href="https://github.com/lakermann/iot-accelerator-game/blob/main/deployment/cli-tools.sh" target="_blank" rel="noopener noreferrer">cli-tools.sh<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <table><thead><tr><th>Tool</th> <th>Version</th> <th>Description</th></tr></thead> <tbody><tr><td><code>azure-cli</code></td> <td>2.22.1</td> <td>Setup Azure backend infrastructure <sup class="footnote-ref"><a href="#fn1" id="fnref1">[1]</a></sup></td></tr> <tr><td><code>mssql-tools</code></td> <td>17.7.1.1</td> <td>Create database table <sup class="footnote-ref"><a href="#fn2" id="fnref2">[2]</a></sup></td></tr> <tr><td><code>heroku</code></td> <td>7.52.0</td> <td>Setup and deploy frontend to heroku (optional)  <sup class="footnote-ref"><a href="#fn3" id="fnref3">[3]</a></sup></td></tr></tbody></table> <h2 id="backend-services"><a href="#backend-services" class="header-anchor">#</a> Backend Services</h2> <h3 id="azure-resources"><a href="#azure-resources" class="header-anchor">#</a> Azure Resources</h3> <ul><li>Resource Group
<ul><li>Event Hubs Namespace <sup class="footnote-ref"><a href="#fn4" id="fnref4">[4]</a></sup> <ul><li>Event Hub
<ul><li>Authorization Rule &quot;Sensor&quot; (Send)</li> <li>Authorization Rule &quot;Stream Analytics&quot; (Listen)</li></ul></li></ul></li> <li>SQL Server <sup class="footnote-ref"><a href="#fn5" id="fnref5">[5]</a></sup> <ul><li>SQL Database
<ul><li>Firewall Rule &quot;Azure Services&quot;</li> <li>Firewall Rule &quot;Cli&quot;</li></ul></li></ul></li> <li>Stream Analytics Job <sup class="footnote-ref"><a href="#fn6" id="fnref6">[6]</a></sup> <ul><li>Input &quot;Event Hub&quot;</li> <li>Output &quot;SQL Database&quot;</li> <li>Transformation <sup class="footnote-ref"><a href="#fn7" id="fnref7">[7]</a></sup></li></ul></li></ul></li></ul> <h3 id="azure-deployment"><a href="#azure-deployment" class="header-anchor">#</a> Azure Deployment</h3> <p>Deployment script: <a href="https://github.com/lakermann/iot-accelerator-game/blob/main/deployment/backend-azure.sh" target="_blank" rel="noopener noreferrer">backend-azure.sh<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <div class="language-bash extra-class"><pre class="language-bash"><code>Usage: ./backend-azure.sh <span class="token operator">&lt;</span>command<span class="token operator">&gt;</span>
where <span class="token operator">&lt;</span>command<span class="token operator">&gt;</span> is one of the following
  create
  cleanup
</code></pre></div><ul><li><code>create</code>: create all needed resources in a new resource group in an already existing subscription</li> <li><code>cleanup</code>: delete the resource group with all resources</li></ul> <h4 id="configuration-azure-script"><a href="#configuration-azure-script" class="header-anchor">#</a> Configuration Azure Script</h4> <table><thead><tr><th>Property</th> <th>Description</th></tr></thead> <tbody><tr><td><code>subscription</code></td> <td>Name or ID of subscription.</td></tr> <tr><td><code>event_hubs_namespace</code></td> <td>Event hub namespace, provides network endpoints.</td></tr> <tr><td><code>mssql_server_admin_user</code></td> <td>Administrator username for the server.</td></tr> <tr><td><code>mssql_server_admin_password</code></td> <td>Administrator login password.</td></tr> <tr><td><code>mssql_server_ip_whitelist</code></td> <td>IPv4 address of the firewall rule, used for database access.</td></tr></tbody></table> <h4 id="output"><a href="#output" class="header-anchor">#</a> Output</h4> <div class="language-bash extra-class"><pre class="language-bash"><code>MSSQL connection details
  Host: <span class="token punctuation">..</span>.
  Database: <span class="token punctuation">..</span>.
Event Hub connection details
  URI: <span class="token punctuation">..</span>.
  SAS Token: <span class="token punctuation">..</span>. <span class="token punctuation">(</span>validity: <span class="token number">24</span> hours<span class="token punctuation">)</span>
</code></pre></div><h2 id="frontend"><a href="#frontend" class="header-anchor">#</a> Frontend</h2> <p>Vue.js<sup class="footnote-ref"><a href="#fn8" id="fnref8">[8]</a></sup> web app to collect and push accelerometer events.</p> <h3 id="local-development"><a href="#local-development" class="header-anchor">#</a> Local Development</h3> <h4 id="configuration-env"><a href="#configuration-env" class="header-anchor">#</a> Configuration <code>.env</code></h4> <table><thead><tr><th>Property</th> <th>Description</th></tr></thead> <tbody><tr><td><code>VUE_APP_POST_INTERVAL</code></td> <td>Http post interval (ms)</td></tr> <tr><td><code>VUE_APP_POST_URL</code></td> <td>Http post url (event hub URI)</td></tr> <tr><td><code>VUE_APP_POST_AUTHORIZATION_HEADER</code></td> <td>Http post access token (event hub SAS Token)</td></tr></tbody></table> <h3 id="heroku-deployment"><a href="#heroku-deployment" class="header-anchor">#</a> Heroku Deployment</h3> <p>Deployment script: <a href="https://github.com/lakermann/iot-accelerator-game/blob/main/deployment/frontend-heroku.sh" target="_blank" rel="noopener noreferrer">frontend-heroku.sh<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <div class="language-bash extra-class"><pre class="language-bash"><code>Usage: ./frontend-heroku.sh <span class="token operator">&lt;</span>command<span class="token operator">&gt;</span>
where <span class="token operator">&lt;</span>command<span class="token operator">&gt;</span> is one of the following
  init
  create
</code></pre></div><ul><li><code>create</code>: create heroku app</li> <li><code>cleanup</code>: destroy heroku app</li></ul> <h4 id="configuration-heroku-script"><a href="#configuration-heroku-script" class="header-anchor">#</a> Configuration Heroku Script</h4> <table><thead><tr><th>Property</th> <th>Description</th></tr></thead> <tbody><tr><td><code>application_name</code></td> <td>Heroku application name</td></tr> <tr><td><code>post_interval</code></td> <td>Http post interval (ms)</td></tr> <tr><td><code>post_url</code></td> <td>Http post url (event hub URI)</td></tr> <tr><td><code>post_authorization_header</code></td> <td>Http post access token (event hub SAS Token)</td></tr></tbody></table> <p>In this demo project, the secrets are stored in the app. Usually do not store any secrets (such as private API keys) in
your app! Environment variables are embedded into the build, meaning anyone can view them by inspecting your app's
files.</p> <h2 id="ranking"><a href="#ranking" class="header-anchor">#</a> Ranking</h2> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> username<span class="token punctuation">,</span> <span class="token function">AVG</span><span class="token punctuation">(</span>acceleration_magnitude<span class="token punctuation">)</span> <span class="token keyword">AS</span> average_acceleration_magnitude
<span class="token keyword">FROM</span> METRICS
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> username
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> average_acceleration_magnitude <span class="token keyword">DESC</span><span class="token punctuation">;</span>
</code></pre></div><hr class="footnotes-sep"> <section class="footnotes"><ol class="footnotes-list"><li id="fn1" class="footnote-item"><p><a href="https://docs.microsoft.com/en-us/cli/azure/" target="_blank" rel="noopener noreferrer">https://docs.microsoft.com/en-us/cli/azure/<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <a href="#fnref1" class="footnote-backref">↩︎</a></p></li> <li id="fn2" class="footnote-item"><p><a href="https://docs.microsoft.com/en-us/sql/tools/sqlcmd-utility" target="_blank" rel="noopener noreferrer">https://docs.microsoft.com/en-us/sql/tools/sqlcmd-utility<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <a href="#fnref2" class="footnote-backref">↩︎</a></p></li> <li id="fn3" class="footnote-item"><p><a href="https://devcenter.heroku.com/articles/heroku-cli" target="_blank" rel="noopener noreferrer">https://devcenter.heroku.com/articles/heroku-cli<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <a href="#fnref3" class="footnote-backref">↩︎</a></p></li> <li id="fn4" class="footnote-item"><p><a href="https://docs.microsoft.com/en-us/azure/event-hubs/" target="_blank" rel="noopener noreferrer">https://docs.microsoft.com/en-us/azure/event-hubs/<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <a href="#fnref4" class="footnote-backref">↩︎</a></p></li> <li id="fn5" class="footnote-item"><p><a href="https://docs.microsoft.com/en-us/azure/azure-sql/" target="_blank" rel="noopener noreferrer">https://docs.microsoft.com/en-us/azure/azure-sql/<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <a href="#fnref5" class="footnote-backref">↩︎</a></p></li> <li id="fn6" class="footnote-item"><p><a href="https://docs.microsoft.com/en-us/azure/stream-analytics/" target="_blank" rel="noopener noreferrer">https://docs.microsoft.com/en-us/azure/stream-analytics/<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <a href="#fnref6" class="footnote-backref">↩︎</a></p></li> <li id="fn7" class="footnote-item"><p><a href="https://docs.microsoft.com/en-us/stream-analytics-query/stream-analytics-query-language-reference" target="_blank" rel="noopener noreferrer">https://docs.microsoft.com/en-us/stream-analytics-query/stream-analytics-query-language-reference<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <a href="#fnref7" class="footnote-backref">↩︎</a></p></li> <li id="fn8" class="footnote-item"><p><a href="https://vuejs.org" target="_blank" rel="noopener noreferrer">https://vuejs.org<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <a href="#fnref8" class="footnote-backref">↩︎</a></p></li></ol></section></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/iot-accelerator-game/" class="prev router-link-active">
        Introduction
      </a></span> <span class="next"><a href="/iot-accelerator-game/exercises.html">
        Exercises
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/iot-accelerator-game/assets/js/app.48d93215.js" defer></script><script src="/iot-accelerator-game/assets/js/2.d578e91a.js" defer></script><script src="/iot-accelerator-game/assets/js/9.518203b7.js" defer></script>
  </body>
</html>
